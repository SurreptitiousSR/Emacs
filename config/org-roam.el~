(defun org-roam-node-from-cite (keys-entries)
  "Create an org-roam node from a citation."
  (interactive (list (citar-create-note :multiple nil :rebuild-cache t)))
  (let ((title (citar--format-entry-no-widths (cdr keys-entries)
                                              "${author editor} :: ${title}")))
    (org-roam-capture- :templates
                       '(("r" "reference" plain "%?" :if-new
                          (file+head "reference/${citekey}.org"
                                     ":PROPERTIES:
:ROAM_REFS: [cite:@${citekey}]
:END:
#+title: ${title}\n")
                          :immediate-finish t
                          :unnarrowed t))
                       :info (list :citekey (car keys-entries))
                       :node (org-roam-node-create :title title)
                       :props '(:finalize find-file))))

;; Add a key binding for easy access
(with-eval-after-load 'org-roam
  (define-key org-roam-mode-map (kbd "C-c n r") #'org-roam-node-from-cite))
